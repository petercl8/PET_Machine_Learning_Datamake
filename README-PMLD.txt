INTRODUCTION and LICENSE
========================
The PET Machine Learning Datamake (PMLD) project is a derivative work, with the STIR-GATE Connection (https://github.com/UCL/STIR-GATE-Connection) project serving as a starting point. For clarity (perhaps!), many of the original README files have been left in place. These readme files have filenames ending with '-SGC'. For example, the README-SGC.md file in this directory. These original readme files may have out-of-date information. When information conflicts, our readme files (with extensions .txt) should be preferred.

This work is is under the Apache License. All modifications are Copyright 2024 Peter Lindstrom and Evelyne Hluszok.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

The license can also be found in this folder (LICENSE.txt).

The original work is under Apache License 2.0. Further details are found in README-SGC.md.


OVERVIEW OF FILE TREE
=====================
The files in this file tree were created to generate a dataset including ground truths, sinograms, and image reconstructions for rebinned and non-rebinned data.


git-*.bat: Various batch files used to maintain the repository. Not necessary to run the code.

XCAT_phantomInfo.ods: spreadsheet with full xcat phantom information.

XCAT_sortingInfo.csv: comma-separated value file. This is smaller spreadsheet with information useful for sorting phantoms into training set, test set, validation set, etc.

dataset_notebook: Jupyter notebook which contains phython code for manipulating the dataset. Includes functions for (among other things): displaying data and images, reconstruction, projection, IQA metrics, reading interfiles and storing them in numpy arrays, compiling smaller data sections into larger data structures, sorting phantoms into sets via iterative stratification, and performing ROI analysis. Code here is optimized for Google Colab but can also be run on a local machine.

this_SGC.sh: this file must be left in the main directory. It sets the paths.

AAA-Scripts-msc: Scripts that are not currently being used, but might prove useful to you in your own projects.

Analysis: Scripts for file conversions and analysis of input or output files.

DataCorrectionsComputation: Scripts for data correction, from the original STIR-GATE-Connection project. The code for each of these scripts has been taken out and placed in ./Subscripts/CorrectAndReconstruct.sh. The exception is EstimateGATESTIRNorm.sh, which estimates normalization factors of the scanner. This script needs to only be run once for each scanner you use.

ExamplePhantoms: Example .par files to generate simple voxelized phantoms from STIR utilities.

ExampleScanners: Required GATE and STIR files for various scanners.

QAPhantoms: .par files and scripts to generate more complex quality assurance voxelized phantoms using STIR utilities.

VoxelisedSimulation: Main scripts for creating a voxelized phantom, running a GATE simulation, and putting it into STIR with data corrections, FORE, and image reconstructions.
    __MAIN_SCRIPT.sh: Runs the GATE simulation and reconstruction process. All other files in VoxelisedSimulation (not including the various subfolders) are generated by this script and the scripts that this script calls. These intermediate files can be deleted between runs, if desired.

    __RunMultiplePhantoms.sh: Script which is useful for simulating multiple phantoms in a row. It calls __MAIN_SCRIPT.sh

    CopyToParent: Files to be copied into the parent directory (VoxelisedSimulation) each time the main script is run.

    GATE: macros and other files used by GATE

    NormalisationInterfiles: Interfiles for normalization correction. These are generated by EstimateGATESTIRNorm.sh once for a scanner type, and then used 
    each time the main script is run.

    OurParFiles: STIR .par files used in data correction, image reconstruction, etc.

    Output: Files output by GATE. Created by __MAIN_SCRIPT (when run) if it does not exist.

    extras: Directory which is optionally created to show intermediate results in during data corrections. Created by scripts if it does not exist when run.

    UnlistingTemplates: Scanner templates used when unlisting ROOT files into sinograms. Called by _RunGATEandUnlist.sh.

    SubScripts: Various scripts called by the main script.

        _ChangeSliceNum.sh: Subscript changing the segment of XCAT phantom to be generated, since the whole body cannot be scanned at once.
    
        _CorrectAndReconstruct.sh: Performs data corrections, Fourier rebinning, and image reconstructions.

        _CreateXCAT.sh: Creates an XCAT file.

        _RunGATE.sh: Aligns geometry, runs GATE, and unlists the output ROOT file into a sinogram.

        _STIR2GATE_intefile.sh: convert STIR compatible interfiles to GATE compatible interfiles.

        _UnlistPromptsAndDelayeds.sh: Wrapper for _UnlistRoot.sh that unlists prompts and delayed coincidences.

        _UnlistRoot.sh: File for unlisting ROOT files into interfiles

        _WriteProjInfoToLog.sh: Script to log projection data. Useful for keeping track of the number of counts.

In order for the scripts to properly run, the user must:
-add this_SGC.sh to their .bashrc (example line: source /home/user/STIR-GATE-Connection-simplified/this_SGC.sh)
-set the correct path to XCAT as XCAT_PATH in __MAIN_SCRIPT.sh

Required software:
-GATE 9.2
-Geant4 11.0.0
-STIR 6.0
-ROOT 6.30
-parallelproj 1.8.0
-XCAT (if generating XCAT phantoms)
-Xmedcon 0.21.2 (file conversion from .hdr GATE output to STIR-readable interfile)